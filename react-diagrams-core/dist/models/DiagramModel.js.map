{"version":3,"file":"DiagramModel.js","sourceRoot":"","sources":["../../src/models/DiagramModel.ts"],"names":[],"mappings":"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","sourcesContent":["import _filter from 'lodash/filter';\r\nimport _flatMap from 'lodash/flatMap';\r\nimport _forEach from 'lodash/forEach';\r\nimport _some from 'lodash/some';\r\nimport _values from 'lodash/values';\r\nimport { LinkModel } from '../entities/link/LinkModel';\r\nimport { NodeModel } from '../entities/node/NodeModel';\r\nimport {\r\n\tBaseEntityEvent,\r\n\tBaseEntityListener,\r\n\tBaseModel,\r\n\tCanvasModel,\r\n\tCanvasModelGenerics,\r\n\tLayerModel,\r\n\tDeserializeEvent\r\n} from '@projectstorm/react-canvas-core';\r\nimport { NodeLayerModel } from '../entities/node-layer/NodeLayerModel';\r\nimport { NodeWLayerModel } from '../entities/node-layer-w/NodeWLayerModel';\r\nimport { LinkLayerModel } from '../entities/link-layer/LinkLayerModel';\r\n\r\nexport interface DiagramListener extends BaseEntityListener {\r\n\tnodesUpdated?(event: BaseEntityEvent & { node: NodeModel; isCreated: boolean }): void;\r\n\r\n\tlinksUpdated?(event: BaseEntityEvent & { link: LinkModel; isCreated: boolean }): void;\r\n}\r\n\r\nexport interface DiagramModelGenerics extends CanvasModelGenerics {\r\n\tLISTENER: DiagramListener;\r\n}\r\n\r\nexport class DiagramModel<G extends DiagramModelGenerics = DiagramModelGenerics> extends CanvasModel<G> {\r\n\tprotected activeNodeLayer: NodeLayerModel;\r\n\tprotected activeNodeWLayer: NodeWLayerModel;\r\n\tprotected activeLinkLayer: LinkLayerModel;\r\n\r\n\tconstructor(options: G['OPTIONS'] = {}) {\r\n\t\tsuper(options);\r\n\t\tthis.addLayer(new LinkLayerModel());\r\n\t\tthis.addLayer(new NodeLayerModel());\r\n\t\tthis.addLayer(new NodeWLayerModel());\r\n\t}\r\n\r\n\tdeserialize(event: DeserializeEvent<this>) {\r\n\t\tthis.layers = [];\r\n\t\tsuper.deserialize(event);\r\n\t}\r\n\r\n\taddLayer(layer: LayerModel): void {\r\n\t\tsuper.addLayer(layer);\r\n\t\tif (layer instanceof NodeLayerModel) {\r\n\t\t\tthis.activeNodeLayer = layer;\r\n\t\t}\r\n\t\tif (layer instanceof LinkLayerModel) {\r\n\t\t\tthis.activeLinkLayer = layer;\r\n\t\t}\r\n\t\tif (layer instanceof NodeWLayerModel) {\r\n\t\t\tthis.activeNodeWLayer = layer;\r\n\t\t}\r\n\t}\r\n\r\n\tgetLinkLayers(): LinkLayerModel[] {\r\n\t\treturn _filter(this.layers, (layer) => {\r\n\t\t\treturn layer instanceof LinkLayerModel;\r\n\t\t}) as LinkLayerModel[];\r\n\t}\r\n\r\n\tgetNodeWLayers(): NodeWLayerModel[] {\r\n\t\treturn _filter(this.layers, (layer) => {\r\n\t\t\treturn layer instanceof NodeWLayerModel;\r\n\t\t}) as NodeWLayerModel[];\r\n\t}\r\n\r\n\tgetNodeLayers(): NodeLayerModel[] {\r\n\t\treturn _filter(this.layers, (layer) => {\r\n\t\t\treturn layer instanceof NodeLayerModel;\r\n\t\t}) as NodeLayerModel[];\r\n\t}\r\n\r\n\tgetActiveNodeLayer(): NodeLayerModel {\r\n\t\tif (!this.activeNodeLayer) {\r\n\t\t\tconst layers = [...this.getNodeLayers(),...this.getNodeWLayers()];\r\n\t\t\tif (layers.length === 0) {\r\n\t\t\t\tthis.addLayer(new NodeLayerModel());\r\n\t\t\t\tthis.addLayer(new NodeWLayerModel());\r\n\t\t\t} else {\r\n\t\t\t\tthis.activeNodeLayer = layers[0];\r\n\t\t\t}\r\n\t\tconsole.log('layers abbs',layers);\r\n\r\n\t\t}\r\n\t\tconsole.log('layers this.activeNodeLayer',this.activeNodeLayer);\r\n\t\t\r\n\t\treturn this.activeNodeLayer;\r\n\t}\r\n\r\n\tgetActiveLinkLayer(): LinkLayerModel {\r\n\t\tif (!this.activeLinkLayer) {\r\n\t\t\tconst layers = this.getLinkLayers();\r\n\t\t\tif (layers.length === 0) {\r\n\t\t\t\tthis.addLayer(new LinkLayerModel());\r\n\t\t\t} else {\r\n\t\t\t\tthis.activeLinkLayer = layers[0];\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn this.activeLinkLayer;\r\n\t}\r\n\r\n\tgetNode(node: string): NodeModel {\r\n\t\tfor (const layer of this.getNodeLayers()) {\r\n\t\t\tconst model = layer.getModel(node);\r\n\t\t\tif (model) {\r\n\t\t\t\treturn model;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tgetLink(link: string): LinkModel {\r\n\t\tfor (const layer of this.getLinkLayers()) {\r\n\t\t\tconst model = layer.getModel(link);\r\n\t\t\tif (model) {\r\n\t\t\t\treturn model;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\taddAll(...models: BaseModel[]): BaseModel[] {\r\n\t\t_forEach(models, (model) => {\r\n\t\t\tif (model instanceof LinkModel) {\r\n\t\t\t\tthis.addLink(model);\r\n\t\t\t} else if (model instanceof NodeModel) {\r\n\t\t\t\tthis.addNode(model);\r\n\t\t\t}\r\n\t\t});\r\n\t\treturn models;\r\n\t}\r\n\r\n\taddLink(link: LinkModel): LinkModel {\r\n\t\tthis.getActiveLinkLayer().addModel(link);\r\n\t\tthis.fireEvent(\r\n\t\t\t{\r\n\t\t\t\tlink,\r\n\t\t\t\tisCreated: true\r\n\t\t\t},\r\n\t\t\t'linksUpdated'\r\n\t\t);\r\n\t\treturn link;\r\n\t}\r\n\r\n\taddNode(node: NodeModel): NodeModel {\r\n\t\tthis.getActiveNodeLayer().addModel(node);\r\n\t\tthis.fireEvent({ node, isCreated: true }, 'nodesUpdated');\r\n\t\treturn node;\r\n\t}\r\n\r\n\tremoveLink(link: LinkModel) {\r\n\t\tconst removed = _some(this.getLinkLayers(), (layer) => {\r\n\t\t\treturn layer.removeModel(link);\r\n\t\t});\r\n\t\tif (removed) {\r\n\t\t\tthis.fireEvent({ link, isCreated: false }, 'linksUpdated');\r\n\t\t}\r\n\t}\r\n\r\n\tremoveNode(node: NodeModel) {\r\n\t\tconst removed = _some(this.getNodeLayers(), (layer) => {\r\n\t\t\treturn layer.removeModel(node);\r\n\t\t});\r\n\t\tif (removed) {\r\n\t\t\tthis.fireEvent({ node, isCreated: false }, 'nodesUpdated');\r\n\t\t}\r\n\t}\r\n\r\n\tgetLinks(): LinkModel[] {\r\n\t\treturn _flatMap(this.getLinkLayers(), (layer) => {\r\n\t\t\treturn _values(layer.getModels());\r\n\t\t});\r\n\t}\r\n\r\n\tgetNodes(): NodeModel[] {\r\n\t\treturn _flatMap(this.getNodeLayers(), (layer) => {\r\n\t\t\treturn _values(layer.getModels());\r\n\t\t});\r\n\t}\r\n}\r\n"]}