{"version":3,"file":"CanvasWidget.js","sourceRoot":"","sources":["../../../src/entities/canvas/CanvasWidget.tsx"],"names":[],"mappings":"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","sourcesContent":["import * as React from 'react';\r\nimport { CanvasEngine } from '../../CanvasEngine';\r\nimport { TransformLayerWidget } from '../layer/TransformLayerWidget';\r\nimport styled from '@emotion/styled';\r\nimport { SmartLayerWidget } from '../layer/SmartLayerWidget';\r\n\r\nexport interface DiagramProps {\r\n\tengine: CanvasEngine;\r\n\tclassName?: string;\r\n}\r\n\r\nnamespace S {\r\n\texport const Canvas = styled.div`\r\n\t\tposition: relative;\r\n\t\tcursor: move;\r\n\t\toverflow: hidden;\r\n\t`;\r\n}\r\n\r\nexport class CanvasWidget extends React.Component<DiagramProps> {\r\n\tref: React.RefObject<HTMLDivElement>;\r\n\tkeyUp: any;\r\n\tkeyDown: any;\r\n\tcanvasListener: any;\r\n\r\n\tconstructor(props: DiagramProps) {\r\n\t\tsuper(props);\r\n\r\n\t\tthis.ref = React.createRef();\r\n\t\tthis.state = {\r\n\t\t\taction: null,\r\n\t\t\tdiagramEngineListener: null\r\n\t\t};\r\n\t}\r\n\r\n\tcomponentWillUnmount() {\r\n\t\tthis.props.engine.deregisterListener(this.canvasListener);\r\n\t\tthis.props.engine.setCanvas(null);\r\n\r\n\t\tdocument.removeEventListener('keyup', this.keyUp);\r\n\t\tdocument.removeEventListener('keydown', this.keyDown);\r\n\t}\r\n\r\n\tregisterCanvas() {\r\n\t\tthis.props.engine.setCanvas(this.ref.current);\r\n\t\tthis.props.engine.iterateListeners((list) => {\r\n\t\t\tlist.rendered && list.rendered();\r\n\t\t});\r\n\t}\r\n\r\n\tcomponentDidUpdate() {\r\n\t\tthis.registerCanvas();\r\n\t}\r\n\r\n\tcomponentDidMount() {\r\n\t\tthis.canvasListener = this.props.engine.registerListener({\r\n\t\t\trepaintCanvas: () => {\r\n\t\t\t\tthis.forceUpdate();\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\tthis.keyDown = (event) => {\r\n\t\t\tthis.props.engine.getActionEventBus().fireAction({ event });\r\n\t\t};\r\n\t\tthis.keyUp = (event) => {\r\n\t\t\tthis.props.engine.getActionEventBus().fireAction({ event });\r\n\t\t};\r\n\r\n\t\tdocument.addEventListener('keyup', this.keyUp);\r\n\t\tdocument.addEventListener('keydown', this.keyDown);\r\n\t\tthis.registerCanvas();\r\n\t}\r\n\r\n\trender() {\r\n\t\tconst engine = this.props.engine;\r\n\t\tconst model = engine.getModel();\r\n\r\n\t\t\r\n\t\treturn (\r\n\t\t\t<S.Canvas\r\n\t\t\t\tclassName={this.props.className}\r\n\t\t\t\tref={this.ref}\r\n\t\t\t\tonWheel={(event) => {\r\n\t\t\t\t\tthis.props.engine.getActionEventBus().fireAction({ event });\r\n\t\t\t\t}}\r\n\t\t\t\tonMouseDown={(event) => {\r\n\t\t\t\t\tthis.props.engine.getActionEventBus().fireAction({ event });\r\n\t\t\t\t}}\r\n\t\t\t\tonMouseUp={(event) => {\r\n\t\t\t\t\tthis.props.engine.getActionEventBus().fireAction({ event });\r\n\t\t\t\t}}\r\n\t\t\t\tonMouseMove={(event) => {\r\n\t\t\t\t\tthis.props.engine.getActionEventBus().fireAction({ event });\r\n\t\t\t\t}}\r\n\t\t\t\tonTouchStart={(event) => {\r\n\t\t\t\t\tthis.props.engine.getActionEventBus().fireAction({ event });\r\n\t\t\t\t}}\r\n\t\t\t\tonTouchEnd={(event) => {\r\n\t\t\t\t\tthis.props.engine.getActionEventBus().fireAction({ event });\r\n\t\t\t\t}}\r\n\t\t\t\tonTouchMove={(event) => {\r\n\t\t\t\t\tthis.props.engine.getActionEventBus().fireAction({ event });\r\n\t\t\t\t}}\r\n\t\t\t>\r\n\t\t\t\t   \r\n\t\t\t\t\t{model.getLayers()[2] &&\r\n\t\t\t\t\t<TransformLayerWidget layer={model.getLayers()[2]} key={model.getLayers()[2].getID()}>\r\n\t\t\t\t\t\t\t<SmartLayerWidget layer={model.getLayers()[2]} engine={this.props.engine} key={model.getLayers()[2].getID()} />\r\n\t\t\t\t\t</TransformLayerWidget>}\r\n\t\t\t\t\t<TransformLayerWidget layer={model.getLayers()[0]} key={model.getLayers()[0].getID()}>\r\n\t\t\t\t\t\t\t<SmartLayerWidget layer={model.getLayers()[0]} engine={this.props.engine} key={model.getLayers()[0].getID()} />\r\n\t\t\t\t\t</TransformLayerWidget>\r\n\t\t\t\t\t<TransformLayerWidget layer={model.getLayers()[1]} key={model.getLayers()[1].getID()}>\r\n\t\t\t\t\t\t\t<SmartLayerWidget layer={model.getLayers()[1]} engine={this.props.engine} key={model.getLayers()[1].getID()} />\r\n\t\t\t\t\t</TransformLayerWidget>\r\n\t\t\t\t  \r\n\t\t\t</S.Canvas>\r\n\t\t);\r\n\t}\r\n}\r\n"]}