{"version":3,"file":"MoveItemsState.js","sourceRoot":"","sources":["../../src/states/MoveItemsState.ts"],"names":[],"mappings":"AAAA,OAAO,EACL,yBAAyB,GAE1B,MAAM,yCAAyC,CAAC;AAEjD,OAAO,EAAE,MAAM,EAAe,SAAS,EAAE,MAAM,wBAAwB,CAAC;AACxE,OAAO,EAAE,iBAAiB,EAAE,MAAM,kCAAkC,CAAC;AAIrE,MAAM,OAAO,cAEX,SAAQ,yBAA4B;IAQpC;QACE,KAAK,CAAC;YACJ,IAAI,EAAE,YAAY;SACnB,CAAC,CAAC;QACH,IAAI,CAAC,cAAc,CACjB,IAAI,MAAM,CAAC;YACT,IAAI,EAAE,SAAS,CAAC,UAAU;YAC1B,IAAI,EAAE,CAAC,KAAoC,EAAE,EAAE;gBAC7C,MAAM,OAAO,GAAG,IAAI,CAAC,MAAM;qBACxB,iBAAiB,EAAE;qBACnB,gBAAgB,CAAC,KAAK,CAAC,CAAC;gBAC3B,IAAI,CAAC,OAAO,EAAE,CAAC;oBACb,OAAO;gBACT,CAAC;gBAED,MAAM,iBAAiB,GACrB,KAAK,CAAC,KAAK,CAAC,QAAQ,IAAI,KAAK,CAAC,KAAK,CAAC,OAAO,IAAI,KAAK,CAAC,KAAK,CAAC,OAAO,CAAC;gBAErE,IAAI,iBAAiB,EAAE,CAAC;oBACtB,OAAO,CAAC,WAAW,CAAC,CAAC,OAAO,CAAC,UAAU,EAAE,CAAC,CAAC;gBAC7C,CAAC;qBAAM,CAAC;oBACN,IACE,CAAC,OAAO,CAAC,UAAU,EAAE;wBACrB,IAAI,CAAC,MAAM,CAAC,QAAQ,EAAE,CAAC,mBAAmB,EAAE,CAAC,MAAM,GAAG,CAAC,EACvD,CAAC;wBACD,IAAI,CAAC,MAAM,CAAC,QAAQ,EAAE,CAAC,cAAc,EAAE,CAAC;oBAC1C,CAAC;oBAED,OAAO,CAAC,WAAW,CAAC,IAAI,CAAC,CAAC;gBAC5B,CAAC;gBAED,IAAI,CAAC,MAAM,CAAC,aAAa,EAAE,CAAC;YAC9B,CAAC;SACF,CAAC,CACH,CAAC;IACJ,CAAC;IAED,SAAS,CAAC,QAAe;QACvB,KAAK,CAAC,SAAS,CAAC,QAAQ,CAAC,CAAC;QAC1B,IAAI,CAAC,gBAAgB,GAAG,EAAE,CAAC;IAC7B,CAAC;IAED,cAAc,CAAC,KAAqC;QAClD,MAAM,KAAK,GAAG,IAAI,CAAC,MAAM,CAAC,QAAQ,EAAE,CAAC,mBAAmB,EAAE,CAAC;QAC3D,MAAM,KAAK,GAAG,IAAI,CAAC,MAAM,CAAC,QAAQ,EAAE,CAAC;QACrC,KAAK,IAAI,IAAI,IAAI,KAAK,EAAE,CAAC;YACvB,IAAI,IAAI,YAAY,iBAAiB,EAAE,CAAC;gBACtC,IAAI,IAAI,CAAC,QAAQ,EAAE,EAAE,CAAC;oBACpB,SAAS;gBACX,CAAC;gBACD,IAAI,CAAC,IAAI,CAAC,gBAAgB,CAAC,IAAI,CAAC,KAAK,EAAE,CAAC,EAAE,CAAC;oBACzC,IAAI,CAAC,gBAAgB,CAAC,IAAI,CAAC,KAAK,EAAE,CAAC,GAAG;wBACpC,KAAK,EAAE,IAAI,CAAC,WAAW,EAAE;wBACzB,IAAI,EAAE,IAAI;qBACX,CAAC;gBACJ,CAAC;gBAED,MAAM,GAAG,GAAG,IAAI,CAAC,gBAAgB,CAAC,IAAI,CAAC,KAAK,EAAE,CAAC,CAAC,KAAK,CAAC;gBACtD,IAAI,CAAC,WAAW,CACd,KAAK,CAAC,eAAe,CAAC,GAAG,CAAC,CAAC,GAAG,KAAK,CAAC,oBAAoB,CAAC,EACzD,KAAK,CAAC,eAAe,CAAC,GAAG,CAAC,CAAC,GAAG,KAAK,CAAC,oBAAoB,CAAC,CAC1D,CAAC;YACJ,CAAC;QACH,CAAC;QACD,IAAI,CAAC,MAAM,CAAC,aAAa,EAAE,CAAC;IAC9B,CAAC;CACF","sourcesContent":["import {\r\n  AbstractDisplacementState,\r\n  AbstractDisplacementStateEvent,\r\n} from \"../core-state/AbstractDisplacementState\";\r\nimport { State } from \"../core-state/State\";\r\nimport { Action, ActionEvent, InputType } from \"../core-actions/Action\";\r\nimport { BasePositionModel } from \"../core-models/BasePositionModel\";\r\nimport { Point } from \"@projectstorm/geometry\";\r\nimport { CanvasEngine } from \"../CanvasEngine\";\r\n\r\nexport class MoveItemsState<\r\n  E extends CanvasEngine = CanvasEngine,\r\n> extends AbstractDisplacementState<E> {\r\n  initialPositions: {\r\n    [id: string]: {\r\n      point: Point;\r\n      item: BasePositionModel;\r\n    };\r\n  };\r\n\r\n  constructor() {\r\n    super({\r\n      name: \"move-items\",\r\n    });\r\n    this.registerAction(\r\n      new Action({\r\n        type: InputType.MOUSE_DOWN,\r\n        fire: (event: ActionEvent<React.MouseEvent>) => {\r\n          const element = this.engine\r\n            .getActionEventBus()\r\n            .getModelForEvent(event);\r\n          if (!element) {\r\n            return;\r\n          }\r\n\r\n          const isModifierPressed =\r\n            event.event.shiftKey || event.event.ctrlKey || event.event.metaKey;\r\n\r\n          if (isModifierPressed) {\r\n            element.setSelected(!element.isSelected());\r\n          } else {\r\n            if (\r\n              !element.isSelected() ||\r\n              this.engine.getModel().getSelectedEntities().length > 1\r\n            ) {\r\n              this.engine.getModel().clearSelection();\r\n            }\r\n\r\n            element.setSelected(true);\r\n          }\r\n\r\n          this.engine.repaintCanvas();\r\n        },\r\n      })\r\n    );\r\n  }\r\n\r\n  activated(previous: State) {\r\n    super.activated(previous);\r\n    this.initialPositions = {};\r\n  }\r\n\r\n  fireMouseMoved(event: AbstractDisplacementStateEvent) {\r\n    const items = this.engine.getModel().getSelectedEntities();\r\n    const model = this.engine.getModel();\r\n    for (let item of items) {\r\n      if (item instanceof BasePositionModel) {\r\n        if (item.isLocked()) {\r\n          continue;\r\n        }\r\n        if (!this.initialPositions[item.getID()]) {\r\n          this.initialPositions[item.getID()] = {\r\n            point: item.getPosition(),\r\n            item: item,\r\n          };\r\n        }\r\n\r\n        const pos = this.initialPositions[item.getID()].point;\r\n        item.setPosition(\r\n          model.getGridPosition(pos.x + event.virtualDisplacementX),\r\n          model.getGridPosition(pos.y + event.virtualDisplacementY)\r\n        );\r\n      }\r\n    }\r\n    this.engine.repaintCanvas();\r\n  }\r\n}\r\n"]}